<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BeatForge Studio - Web DAW</title>
    <link rel="icon" type="image/png" href="img/BeatForge%20Studio.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="css/styles.css">
</head>

<body class="h-screen flex flex-col">

    <!-- HEADER / TRANSPORT -->
    <header class="header-container bg-neutral-900 border-b border-gray-800 shrink-0 z-20" role="banner">
        <div class="header-content">
            <!-- Logo and Title -->
            <div class="logo-section">
                <div class="flex items-center" role="heading" aria-level="1">
                    <img src="img/BeatForge%20Studio.png" alt="BeatForge Studio Logo" class="h-8 md:h-10 w-auto mr-2">
                    <span class="text-blue-500 font-bold text-lg md:text-xl tracking-wider hidden sm:inline">BeatForge
                        Studio</span>
                    <span class="text-blue-500 font-bold text-lg md:text-xl tracking-wider sm:hidden">BeatForge</span>
                </div>
            </div>

            <!-- Transport Controls -->
            <nav aria-label="Transport controls" class="transport-controls">
                <button id="playBtn" aria-label="Play (Spacebar)"
                    class="btn-transport bg-green-600 hover:bg-green-500 text-white">
                    <i class="fas fa-play" aria-hidden="true"></i>
                </button>
                <button id="stopBtn" aria-label="Stop" class="btn-transport bg-gray-700 hover:bg-gray-600 text-white">
                    <i class="fas fa-stop" aria-hidden="true"></i>
                </button>
            </nav>

            <!-- BPM Control -->
            <div class="control-group">
                <label for="bpmInput" class="control-label">BPM</label>
                <input type="number" id="bpmInput" value="120" min="40" max="240" aria-label="Beats per minute"
                    class="control-input w-14 md:w-16">
            </div>

            <!-- Swing Control -->
            <div class="control-group hidden md:flex">
                <label for="swingInput" class="control-label">Swing</label>
                <input type="range" id="swingInput" min="0" max="0.5" step="0.01" value="0" aria-label="Swing amount"
                    class="w-16 md:w-20 focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>

            <!-- Visualizer -->
            <canvas id="visualizer" width="240" height="60" aria-label="Audio visualizer"
                class="visualizer hidden lg:block"></canvas>

            <!-- Pattern Selector -->
            <div class="control-group hidden lg:flex">
                <label for="patternSelect" class="control-label">Pattern</label>
                <select id="patternSelect" aria-label="Select pattern"
                    class="bg-gray-800 text-white px-2 py-1 rounded text-xs focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="0">Pattern 1</option>
                </select>
            </div>

            <!-- Master Volume -->
            <div class="control-group hidden sm:flex">
                <label for="masterVol" class="control-label">Master</label>
                <input type="range" id="masterVol" min="0" max="1" step="0.01" value="0.8" aria-label="Master volume"
                    class="w-16 md:w-24 focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>

            <!-- Recording Controls -->
            <nav aria-label="Recording controls" class="flex gap-1 hidden md:flex">
                <button id="recordBtn" aria-label="Start/Resume Recording"
                    class="px-2 py-2 bg-red-600 hover:bg-red-500 text-white rounded text-xs font-bold focus:outline-none focus:ring-2 focus:ring-red-400">
                    <i class="fas fa-circle"></i>
                </button>
                <button id="pauseRecordBtn" aria-label="Pause Recording" disabled
                    class="px-2 py-2 bg-yellow-600 hover:bg-yellow-500 text-white rounded text-xs font-bold focus:outline-none focus:ring-2 focus:ring-yellow-400 disabled:opacity-50 disabled:cursor-not-allowed">
                    <i class="fas fa-pause"></i>
                </button>
                <button id="stopRecordBtn" aria-label="Stop Recording" disabled
                    class="px-2 py-2 bg-gray-600 hover:bg-gray-500 text-white rounded text-xs font-bold focus:outline-none focus:ring-2 focus:ring-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">
                    <i class="fas fa-stop"></i>
                </button>
            </nav>

            <!-- Export Button -->
            <button id="exportBtn" onclick="exportProject()" aria-label="Export Recording" disabled
                class="px-3 py-2 bg-purple-600 hover:bg-purple-500 text-white rounded text-xs font-bold hidden md:block focus:outline-none focus:ring-2 focus:ring-purple-400 disabled:opacity-50 disabled:cursor-not-allowed">
                <i class="fas fa-download mr-1"></i>
                <span>Export</span>
            </button>

            <!-- Clear All Button -->
            <button id="clearBtn" onclick="clearAllData()" aria-label="Clear all notes and reset"
                class="px-3 py-2 bg-red-600 hover:bg-red-500 text-white rounded text-xs font-bold hidden md:block focus:outline-none focus:ring-2 focus:ring-red-400">
                <i class="fas fa-trash mr-1"></i>
                <span>Clear All</span>
            </button>

            <!-- Initialize Button -->
            <button id="initAudioBtn" aria-label="Initialize audio engine"
                class="btn-init px-3 md:px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded text-xs md:text-sm font-bold animate-pulse focus:outline-none focus:ring-2 focus:ring-blue-400">
                <span class="hidden md:inline">Initialize Audio</span>
                <span class="md:hidden">Init</span>
            </button>
        </div>
    </header>

    <!-- MAIN WORKSPACE -->
    <main class="main-workspace" role="main">

        <!-- LEFT: TRACK HEADERS -->
        <aside class="track-headers-panel" id="trackHeaders" aria-label="Track controls" role="complementary">
            <!-- Populated by JS -->
        </aside>

        <!-- RIGHT: SEQUENCER GRID -->
        <section class="sequencer-panel" id="sequencerArea" aria-label="Sequencer grid" role="region">
            <!-- Grid Background -->
            <div id="gridCanvas" class="grid-container" role="grid" aria-label="Step sequencer">
                <!-- Populated by JS -->
            </div>
        </section>
    </main>

    <!-- FOOTER / GLOBAL FX -->
    <footer class="footer-container" role="contentinfo">
        <section class="effects-section" aria-label="Global effects">
            <!-- Reverb -->
            <div class="effect-group">
                <div class="effect-title text-blue-400">
                    <i class="fas fa-water mr-1"></i>
                    <span class="hidden sm:inline">Reverb Room</span>
                    <span class="sm:hidden">Reverb</span>
                </div>
                <div class="effect-controls">
                    <div class="effect-control">
                        <label for="reverbTime" class="effect-label">Decay</label>
                        <input type="range" id="reverbTime" min="0.1" max="5" step="0.1" value="2"
                            aria-label="Reverb decay time" class="effect-slider">
                    </div>
                </div>
            </div>

            <!-- Delay -->
            <div class="effect-group">
                <div class="effect-title text-purple-400">
                    <i class="fas fa-clock mr-1"></i>
                    <span class="hidden sm:inline">Stereo Delay</span>
                    <span class="sm:hidden">Delay</span>
                </div>
                <div class="effect-controls">
                    <div class="effect-control">
                        <label for="delayTime" class="effect-label">Time</label>
                        <input type="range" id="delayTime" min="0" max="1" step="0.05" value="0.3"
                            aria-label="Delay time" class="effect-slider">
                    </div>
                    <div class="effect-control">
                        <label for="delayFeedback" class="effect-label">Feedback</label>
                        <input type="range" id="delayFeedback" min="0" max="0.9" step="0.05" value="0.4"
                            aria-label="Delay feedback" class="effect-slider">
                    </div>
                </div>
            </div>
        </section>

        <!-- Info Section -->
        <div class="info-section">
            <div class="text-center">
                <p class="text-xs md:text-sm font-bold">BeatForge Studio v1.0</p>
                <p class="text-[10px] md:text-xs mt-1 hidden sm:block">Web Audio API • LocalStorage • Tailwind</p>
                <button id="showShortcutsBtn" aria-label="Show keyboard shortcuts"
                    class="mt-1 md:mt-2 text-[10px] md:text-xs text-blue-400 hover:text-blue-300 underline focus:outline-none focus:ring-2 focus:ring-blue-500">
                    Shortcuts (?)
                </button>
            </div>
        </div>
    </footer>

    <!-- KEYBOARD SHORTCUTS HELP MODAL -->
    <div id="shortcutsModal" class="modal fixed inset-0 bg-black/80 z-50 flex items-center justify-center" role="dialog"
        aria-modal="true" aria-labelledby="shortcutsTitle">
        <div class="bg-gray-900 rounded-lg p-6 max-w-md border border-gray-700">
            <div class="flex justify-between items-center mb-4">
                <h2 id="shortcutsTitle" class="text-white font-bold text-lg">Keyboard Shortcuts</h2>
                <button onclick="closeShortcuts()" aria-label="Close shortcuts help"
                    class="text-gray-400 hover:text-white focus:outline-none focus:ring-2 focus:ring-white">
                    <i class="fas fa-times" aria-hidden="true"></i>
                </button>
            </div>
            <div class="text-gray-300 text-sm space-y-2">
                <div class="flex justify-between border-b border-gray-700 pb-2">
                    <span class="font-mono bg-gray-800 px-2 py-1 rounded">Space</span>
                    <span>Play / Pause</span>
                </div>
                <div class="flex justify-between border-b border-gray-700 pb-2">
                    <span class="font-mono bg-gray-800 px-2 py-1 rounded">Esc</span>
                    <span>Close Piano Roll</span>
                </div>
                <div class="flex justify-between border-b border-gray-700 pb-2">
                    <span class="font-mono bg-gray-800 px-2 py-1 rounded">Delete / Backspace</span>
                    <span>Clear Track Notes</span>
                </div>
                <div class="flex justify-between border-b border-gray-700 pb-2">
                    <span class="font-mono bg-gray-800 px-2 py-1 rounded">Ctrl+S / Cmd+S</span>
                    <span>Save State</span>
                </div>
                <div class="flex justify-between border-b border-gray-700 pb-2">
                    <span class="font-mono bg-gray-800 px-2 py-1 rounded">?</span>
                    <span>Show This Help</span>
                </div>
            </div>
        </div>
    </div>

    <!-- PIANO ROLL MODAL -->
    <div id="pianoRollModal" class="modal fixed inset-0 bg-black/90 z-50 flex flex-col" role="dialog" aria-modal="true"
        aria-labelledby="pianoRollTitle">
        <div class="h-12 bg-gray-800 flex items-center justify-between px-4 border-b border-gray-700">
            <h2 id="pianoRollTitle" class="text-white font-bold">Piano Roll</h2>
            <button onclick="closePianoRoll()" aria-label="Close piano roll (ESC)"
                class="text-gray-400 hover:text-white focus:outline-none focus:ring-2 focus:ring-white">
                <i class="fas fa-times text-xl" aria-hidden="true"></i>
            </button>
        </div>
        <div class="flex-1 flex overflow-hidden">
            <!-- Keys -->
            <aside class="w-16 bg-gray-900 flex flex-col border-r border-gray-700" id="pianoKeys"
                aria-label="Piano keys" role="complementary"></aside>
            <!-- Grid -->
            <section class="flex-1 bg-[#1e1e1e] relative overflow-auto" id="pianoGrid" role="grid"
                aria-label="Note grid"></section>
        </div>
    </div>

    <!-- JAVASCRIPT -->
    <script type="module" src="js/app.js"></script>
</body>

</html>