<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>BeatForge Studio - Web DAW</title>
    <link rel="icon" type="image/png" href="img/BeatForge%20Studio.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="css/styles.css">
</head>

<body class="h-screen flex flex-col">

    <!-- HEADER / TRANSPORT -->
    <header class="header-container bg-neutral-900 border-b border-gray-800 shrink-0 z-20" role="banner">
        <div class="header-content">
            <!-- Mobile Hamburger Button (visible only on mobile < 768px) -->
            <button id="mobileMenuBtn" class="mobile-menu-btn md:hidden" aria-label="Open menu">
                <i class="fas fa-bars"></i>
            </button>

            <!-- Logo and Title -->
            <div class="logo-section">
                <div class="flex items-center" role="heading" aria-level="1">
                    <img src="img/BeatForge%20Studio.png" alt="BeatForge Studio Logo" class="h-8 md:h-10 w-auto">
                    <h1 class="text-blue-500 font-bold text-lg md:text-xl tracking-wider hidden md:inline">BeatForge
                        Studio</h1>
                </div>
            </div>

            <!-- Playback Controls Group -->
            <div class="playback-controls-group">
                <!-- Transport Controls -->
                <nav aria-label="Transport controls" class="transport-controls">
                    <button id="playBtn" aria-label="Play (Spacebar)" data-tooltip="Play/Pause"
                        data-tooltip-shortcut="Space" class="btn-transport bg-green-600 hover:bg-green-500 text-white">
                        <i class="fas fa-play" aria-hidden="true"></i>
                    </button>
                    <button id="stopBtn" aria-label="Stop" data-tooltip="Stop playback"
                        class="btn-transport bg-gray-700 hover:bg-gray-600 text-white">
                        <i class="fas fa-stop" aria-hidden="true"></i>
                    </button>
                </nav>

                <!-- BPM Control -->
                <div class="control-group" data-tooltip="Tempo in beats per minute (40-240)">
                    <label for="bpmInput" class="control-label">BPM</label>
                    <input type="number" id="bpmInput" value="120" min="40" max="240" aria-label="Beats per minute"
                        class="control-input w-14 md:w-16">
                </div>

                <!-- Swing Control -->
                <div class="control-group hidden md:flex" data-tooltip="Add groove and timing variation">
                    <label for="swingInput" class="control-label">Swing</label>
                    <input type="range" id="swingInput" min="0" max="0.5" step="0.01" value="0"
                        aria-label="Swing amount"
                        class="w-16 md:w-20 focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>

                <!-- Master Volume -->
                <div class="control-group hidden md:flex">
                    <label for="masterVol" class="control-label">Master</label>
                    <input type="range" id="masterVol" min="0" max="1" step="0.01" value="0.8"
                        aria-label="Master volume"
                        class="w-16 md:w-24 focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
            </div>

            <!-- Visualizer -->
            <div class="visualizer-container hidden xl:flex">
                <canvas id="visualizer" width="320" height="80" aria-label="Audio visualizer"
                    class="visualizer"></canvas>
                <button id="visualizerModeBtn" aria-label="Change visualizer mode" class="visualizer-mode-btn">
                    <i class="fas fa-chart-bar"></i>
                </button>
            </div>

            <!-- Recording Controls Group -->
            <div class="recording-controls-group hidden md:flex">
                <nav aria-label="Recording controls" class="flex gap-1">
                    <button id="recordBtn" aria-label="Start/Resume Recording" data-tooltip="Start recording"
                        class="px-2 py-2 bg-red-600 hover:bg-red-500 text-white rounded text-xs font-bold focus:outline-none focus:ring-2 focus:ring-red-400">
                        <i class="fas fa-circle"></i>
                    </button>
                    <button id="pauseRecordBtn" aria-label="Pause Recording" data-tooltip="Pause recording" disabled
                        class="px-2 py-2 bg-yellow-600 hover:bg-yellow-500 text-white rounded text-xs font-bold focus:outline-none focus:ring-2 focus:ring-yellow-400 disabled:opacity-50 disabled:cursor-not-allowed">
                        <i class="fas fa-pause"></i>
                    </button>
                    <button id="stopRecordBtn" aria-label="Stop Recording" data-tooltip="Stop recording" disabled
                        class="px-2 py-2 bg-gray-600 hover:bg-gray-500 text-white rounded text-xs font-bold focus:outline-none focus:ring-2 focus:ring-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">
                        <i class="fas fa-stop"></i>
                    </button>
                </nav>
            </div>

            <!-- Pattern Selector -->
            <!-- <div class="control-group hidden lg:flex">
                <label for="patternSelect" class="control-label">Pattern</label>
                <select id="patternSelect" aria-label="Select pattern"
                    class="bg-gray-800 text-white px-2 py-1 rounded text-xs focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="0">Pattern 1</option>
                </select>
            </div> -->

            <!-- Action Buttons Group - Dropdown Menu -->
            <div class="action-buttons-group hidden md:flex">
                <div class="relative">
                    <button id="actionsMenuBtn" aria-label="Actions menu"
                        class="px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded text-xs font-bold focus:outline-none focus:ring-2 focus:ring-blue-400">
                        <i class="fas fa-ellipsis-v mr-1"></i>
                        <span>Actions</span>
                        <i class="fas fa-chevron-down ml-1 text-xs"></i>
                    </button>
                    <div id="actionsMenu" class="actions-menu hidden">
                        <!-- Initialize Audio -->
                        <button id="initAudioBtn" aria-label="Initialize audio engine"
                            class="actions-menu-item btn-init">
                            <i class="fas fa-play-circle mr-2"></i>
                            <span>Initialize Audio</span>
                        </button>

                        <div class="actions-menu-divider"></div>

                        <!-- Export -->
                        <button id="exportBtn" onclick="exportProject()" aria-label="Export Recording" disabled
                            class="actions-menu-item">
                            <i class="fas fa-download mr-2"></i>
                            <span>Export Recording</span>
                        </button>

                        <!-- Clear All -->
                        <button id="clearBtn" onclick="clearAllData()" aria-label="Clear all notes and reset"
                            class="actions-menu-item">
                            <i class="fas fa-trash mr-2"></i>
                            <span>Clear All</span>
                        </button>

                        <!-- Keyboard Shortcuts -->
                        <button id="showShortcutsBtnMenu" aria-label="Show keyboard shortcuts"
                            class="actions-menu-item">
                            <i class="fas fa-keyboard mr-2"></i>
                            <span>Keyboard Shortcuts</span>
                        </button>

                        <div class="actions-menu-divider"></div>

                        <!-- Theme Submenu -->
                        <div class="actions-menu-section">
                            <div class="actions-menu-section-title">
                                <i class="fas fa-palette mr-2"></i>
                                <span>Theme</span>
                            </div>
                            <div class="theme-options-grid">
                                <button data-theme="dark" class="theme-option-compact active">
                                    <span class="theme-preview-compact"
                                        style="background: linear-gradient(135deg, #121212, #1e1e1e)"></span>
                                    <span class="theme-name-compact">Dark</span>
                                </button>
                                <button data-theme="darker" class="theme-option-compact">
                                    <span class="theme-preview-compact"
                                        style="background: linear-gradient(135deg, #0a0a0a, #141414)"></span>
                                    <span class="theme-name-compact">Darker</span>
                                </button>
                                <button data-theme="cyberpunk" class="theme-option-compact">
                                    <span class="theme-preview-compact"
                                        style="background: linear-gradient(135deg, #0d0221, #ff006e)"></span>
                                    <span class="theme-name-compact">Cyber</span>
                                </button>
                                <button data-theme="neon" class="theme-option-compact">
                                    <span class="theme-preview-compact"
                                        style="background: linear-gradient(135deg, #0a0e27, #00f5ff)"></span>
                                    <span class="theme-name-compact">Neon</span>
                                </button>
                                <button data-theme="ocean" class="theme-option-compact">
                                    <span class="theme-preview-compact"
                                        style="background: linear-gradient(135deg, #001f3f, #00d9ff)"></span>
                                    <span class="theme-name-compact">Ocean</span>
                                </button>
                                <button data-theme="sunset" class="theme-option-compact">
                                    <span class="theme-preview-compact"
                                        style="background: linear-gradient(135deg, #1a0f0f, #ff6b35)"></span>
                                    <span class="theme-name-compact">Sunset</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
    </header>

    <!-- MOBILE HAMBURGER MENU (visible only on mobile < 768px) -->
    <div id="mobileMenu" class="mobile-menu" aria-hidden="true">
        <!-- Menu Content -->
        <div class="mobile-menu-content">
            <!-- Menu Header -->
            <div class="mobile-menu-header">
                <h2 class="text-lg font-bold text-white">Menu</h2>
                <button id="closeMobileMenuBtn" class="mobile-menu-close" aria-label="Close menu">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <!-- Pattern Selector -->
            <!-- <div class="mobile-menu-section">
                <h3 class="mobile-menu-section-title">
                    <i class="fas fa-music mr-2"></i>Pattern
                </h3>
                <div class="mobile-menu-item">
                    <select id="patternSelectMobile" aria-label="Select pattern"
                        class="w-full bg-gray-800 text-white px-3 py-2 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="0">Pattern 1</option>
                    </select>
                </div>
            </div> -->

            <!-- Master Controls -->
            <div class="mobile-menu-section">
                <h3 class="mobile-menu-section-title">
                    <i class="fas fa-sliders-h mr-2"></i>Master Controls
                </h3>
                <div class="mobile-menu-item">
                    <label for="masterVolMobile" class="text-xs text-gray-400 mb-1 block">Volume</label>
                    <input type="range" id="masterVolMobile" min="0" max="1" step="0.01" value="0.8"
                        aria-label="Master volume" class="w-full focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div class="mobile-menu-item">
                    <label for="swingInputMobile" class="text-xs text-gray-400 mb-1 block">Swing</label>
                    <input type="range" id="swingInputMobile" min="0" max="0.5" step="0.01" value="0"
                        aria-label="Swing amount" class="w-full focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
            </div>

            <!-- Recording Controls -->
            <div class="mobile-menu-section">
                <h3 class="mobile-menu-section-title">
                    <i class="fas fa-microphone mr-2"></i>Recording
                </h3>
                <div class="mobile-menu-item flex gap-2">
                    <button id="recordBtnMobile" aria-label="Start/Resume Recording"
                        class="flex-1 px-3 py-2 bg-red-600 hover:bg-red-500 text-white rounded text-sm font-bold focus:outline-none focus:ring-2 focus:ring-red-400">
                        <i class="fas fa-circle mr-1"></i>Record
                    </button>
                    <button id="pauseRecordBtnMobile" aria-label="Pause Recording" disabled
                        class="flex-1 px-3 py-2 bg-yellow-600 hover:bg-yellow-500 text-white rounded text-sm font-bold focus:outline-none focus:ring-2 focus:ring-yellow-400 disabled:opacity-50 disabled:cursor-not-allowed">
                        <i class="fas fa-pause mr-1"></i>Pause
                    </button>
                    <button id="stopRecordBtnMobile" aria-label="Stop Recording" disabled
                        class="flex-1 px-3 py-2 bg-gray-600 hover:bg-gray-500 text-white rounded text-sm font-bold focus:outline-none focus:ring-2 focus:ring-gray-400 disabled:opacity-50 disabled:cursor-not-allowed">
                        <i class="fas fa-stop mr-1"></i>Stop
                    </button>
                </div>
            </div>

            <!-- Actions -->
            <div class="mobile-menu-section">
                <h3 class="mobile-menu-section-title">
                    <i class="fas fa-cog mr-2"></i>Actions
                </h3>
                <button id="exportBtnMobile" aria-label="Export Recording" disabled
                    class="mobile-menu-button bg-purple-600 hover:bg-purple-500 disabled:opacity-50 disabled:cursor-not-allowed">
                    <i class="fas fa-download mr-2"></i>Export
                </button>
                <button id="clearAllBtnMobile" aria-label="Clear all notes and reset"
                    class="mobile-menu-button bg-red-600 hover:bg-red-500">
                    <i class="fas fa-trash mr-2"></i>Clear All
                </button>
                <button id="themeBtnMobile" aria-label="Change theme"
                    class="mobile-menu-button bg-gray-700 hover:bg-gray-600">
                    <i class="fas fa-palette mr-2"></i>Theme
                </button>
            </div>

            <!-- Shortcuts -->
            <div class="mobile-menu-section">
                <button id="shortcutsBtnMobile" class="mobile-menu-button bg-blue-600 hover:bg-blue-500">
                    <i class="fas fa-keyboard mr-2"></i>Keyboard Shortcuts
                </button>
            </div>
        </div>
    </div>

    <!-- Mobile Menu Backdrop -->
    <div id="mobileMenuBackdrop" class="mobile-menu-backdrop" aria-hidden="true"></div>

    <!-- MAIN WORKSPACE -->
    <main class="main-workspace" role="main">

        <!-- LEFT: TRACK HEADERS -->
        <aside class="track-headers-panel" id="trackHeaders" aria-label="Track controls" role="complementary">
            <!-- Populated by JS -->
        </aside>

        <!-- RIGHT: SEQUENCER GRID -->
        <section class="sequencer-panel" id="sequencerArea" aria-label="Sequencer grid" role="region">
            <!-- Grid Background -->
            <div id="gridCanvas" class="grid-container" role="grid" aria-label="Step sequencer">
                <!-- Populated by JS -->
            </div>
        </section>
    </main>

    <!-- FOOTER / GLOBAL FX -->
    <footer class="footer-container" role="contentinfo">
        <section class="effects-section" aria-label="Global effects">
            <!-- Reverb -->
            <div class="effect-group">
                <div class="effect-title text-blue-400">
                    <i class="fas fa-water mr-1"></i>
                    <span class="hidden sm:inline">Reverb Room</span>
                    <span class="sm:hidden">Reverb</span>
                </div>
                <div class="effect-controls">
                    <div class="effect-control">
                        <label for="reverbTime" class="effect-label">Decay</label>
                        <input type="range" id="reverbTime" min="0.1" max="5" step="0.1" value="2"
                            aria-label="Reverb decay time" class="effect-slider">
                    </div>
                </div>
            </div>

            <!-- Delay -->
            <div class="effect-group">
                <div class="effect-title text-purple-400">
                    <i class="fas fa-clock mr-1"></i>
                    <span class="hidden sm:inline">Stereo Delay</span>
                    <span class="sm:hidden">Delay</span>
                </div>
                <div class="effect-controls">
                    <div class="effect-control">
                        <label for="delayTime" class="effect-label">Time</label>
                        <input type="range" id="delayTime" min="0" max="1" step="0.05" value="0.3"
                            aria-label="Delay time" class="effect-slider">
                    </div>
                    <div class="effect-control">
                        <label for="delayFeedback" class="effect-label">Feedback</label>
                        <input type="range" id="delayFeedback" min="0" max="0.9" step="0.05" value="0.4"
                            aria-label="Delay feedback" class="effect-slider">
                    </div>
                </div>
            </div>
        </section>

        <!-- Info Section -->
        <div class="info-section">
            <div class="text-center">
                <p class="text-xs md:text-sm font-bold">BeatForge Studio v1.0</p>
                <p class="text-[10px] md:text-xs mt-1 hidden sm:block">Web Audio API â€¢ LocalStorage</p>
                <button id="showShortcutsBtn" aria-label="Show keyboard shortcuts"
                    class="mt-1 md:mt-2 text-[10px] md:text-xs text-blue-400 hover:text-blue-300 underline focus:outline-none focus:ring-2 focus:ring-blue-500 md:hidden">
                    Shortcuts (?)
                </button>
            </div>
        </div>
    </footer>

    <!-- KEYBOARD SHORTCUTS HELP MODAL -->
    <div id="shortcutsModal" class="modal fixed inset-0 bg-black/80 z-50 flex items-center justify-center" role="dialog"
        aria-modal="true" aria-labelledby="shortcutsTitle">
        <div class="bg-gray-900 rounded-lg p-6 max-w-md border border-gray-700">
            <div class="flex justify-between items-center mb-4">
                <h2 id="shortcutsTitle" class="text-white font-bold text-lg">Keyboard Shortcuts</h2>
                <button onclick="closeShortcuts()" aria-label="Close shortcuts help"
                    class="text-gray-400 hover:text-white focus:outline-none focus:ring-2 focus:ring-white">
                    <i class="fas fa-times" aria-hidden="true"></i>
                </button>
            </div>
            <div class="text-gray-300 text-sm space-y-2">
                <div class="flex justify-between border-b border-gray-700 pb-2">
                    <span class="font-mono bg-gray-800 px-2 py-1 rounded">Space</span>
                    <span>Play / Pause</span>
                </div>
                <div class="flex justify-between border-b border-gray-700 pb-2">
                    <span class="font-mono bg-gray-800 px-2 py-1 rounded">Esc</span>
                    <span>Close Piano Roll</span>
                </div>
                <div class="flex justify-between border-b border-gray-700 pb-2">
                    <span class="font-mono bg-gray-800 px-2 py-1 rounded">Delete / Backspace</span>
                    <span>Clear Track Notes</span>
                </div>
                <div class="flex justify-between border-b border-gray-700 pb-2">
                    <span class="font-mono bg-gray-800 px-2 py-1 rounded">Ctrl+S / Cmd+S</span>
                    <span>Save State</span>
                </div>
                <div class="flex justify-between border-b border-gray-700 pb-2">
                    <span class="font-mono bg-gray-800 px-2 py-1 rounded">?</span>
                    <span>Show This Help</span>
                </div>
            </div>
        </div>
    </div>

    <!-- PIANO ROLL MODAL -->
    <div id="pianoRollModal" class="modal fixed inset-0 bg-black/90 z-50 flex flex-col" role="dialog" aria-modal="true"
        aria-labelledby="pianoRollTitle">
        <div class="h-12 bg-gray-800 flex items-center justify-between px-4 border-b border-gray-700">
            <h2 id="pianoRollTitle" class="text-white font-bold">Piano Roll</h2>
            <button onclick="closePianoRoll()" aria-label="Close piano roll (ESC)"
                class="text-gray-400 hover:text-white focus:outline-none focus:ring-2 focus:ring-white">
                <i class="fas fa-times text-xl" aria-hidden="true"></i>
            </button>
        </div>
        <div class="flex-1 flex overflow-hidden">
            <!-- Keys -->
            <aside class="w-16 bg-gray-900 flex flex-col border-r border-gray-700" id="pianoKeys"
                aria-label="Piano keys" role="complementary"></aside>
            <!-- Grid -->
            <section class="flex-1 bg-[#1e1e1e] relative overflow-auto" id="pianoGrid" role="grid"
                aria-label="Note grid"></section>
        </div>
    </div>

    <!-- TOAST NOTIFICATION CONTAINER -->
    <div id="toastContainer" class="toast-container" aria-live="polite" aria-atomic="true"></div>

    <!-- KEYBOARD SHORTCUTS OVERLAY -->
    <div id="shortcutsOverlay" class="shortcuts-overlay hidden">
        <div class="shortcuts-overlay-header">
            <h3 class="shortcuts-overlay-title">
                <i class="fas fa-keyboard mr-2"></i>
                Shortcuts
            </h3>
            <button id="toggleShortcutsOverlay" aria-label="Toggle shortcuts panel" class="shortcuts-toggle-btn">
                <i class="fas fa-chevron-down"></i>
            </button>
        </div>
        <div class="shortcuts-overlay-content">
            <div class="shortcut-item">
                <kbd>Space</kbd>
                <span>Play/Pause</span>
            </div>
            <div class="shortcut-item">
                <kbd>Esc</kbd>
                <span>Close Piano Roll</span>
            </div>
            <div class="shortcut-item">
                <kbd>Del</kbd>
                <span>Clear Track</span>
            </div>
            <div class="shortcut-item">
                <kbd>Ctrl</kbd> + <kbd>S</kbd>
                <span>Save State</span>
            </div>
            <div class="shortcut-item">
                <kbd>?</kbd>
                <span>Show Help</span>
            </div>
        </div>
    </div>

    <!-- JAVASCRIPT -->
    <script type="module" src="js/app.js"></script>
</body>

</html>